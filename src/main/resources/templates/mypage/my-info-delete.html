<!-- í˜ì´ì§€ì˜ ì œëª© ì„¤ì • -->
	<title>ê³„ì • íƒˆí‡´</title>

<!-- í•´ë‹¹ í˜ì´ì§€ ê³ ìœ  CSS ì¶”ê°€ -->
<th:block layout:fragment="css">
	<link rel="stylesheet" th:href="@{/css/mypage.css}">
	<style>
		.content {
			width: 815px;
			margin: 7.5px;
		}
		.content > h2 {
			border-bottom: 1px solid #B81426;
		}
		#withdrawalReason-title {
			display: flex;
			flex-direction: row;
		}
		#withdrawalError {
			margin-left: 5px;
			font-size: 13px;
			font-weight: 600;
		}
		.delete-h3 {
			color: #B81426 !important;
			padding-bottom: 3px !important;
			margin: 0 !important;
		}
		p {
			margin: 0 0 10px;
			font-weight: 600;
			font-size: 15px;
		}
		#withdrawal_btn {
            background: linear-gradient(to right, #B81426, #c64351);
            width: 340px;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        #withdrawal_btn:hover {
            background: linear-gradient(to right, #93101e, #B81426);
            transform: translateY(-2px);
        }
        #withdrawal_btn:active {
            transform: translateY(0);
        }

		input[type="radio"] {
			display: none;
		}

		label {
			display: inline-block;
			border: 1px solid #B81426;
			padding: 5px 15px;
			border-radius: 5px;
			margin-right: 10px;
			margin-bottom: 10px;
			cursor: pointer;
			transition: background 0.3s;
			width: 130px;
			text-align: center;
		}

		input[type="radio"]:checked + label {
			background-color: #B81426;
			color: white;
		}

		#otherReasons {
			display: block;
			width: 317px;
			padding: 10px;
			margin-bottom: 20px;
			border: 1px solid #E0E0E0;
			border-radius: 5px;
			resize: vertical;
		}

		#otherReasons:focus {
			border-color: #B81426;
			outline-style: solid;
			outline-width: 1px;
			outline-color: #B81426;
			box-shadow: 0 0 5px rgba(184, 20, 38, 0.5);
		}
	</style>
</th:block>

	<div class="content">
		<h2>ê³„ì • íƒˆí‡´</h2>
		<h3 class="delete-h3">íƒˆí‡´ ì „ ì•ˆë‚´ì‚¬í•­</h3>
		<p>ğŸš« ê³„ì • íƒˆí‡´ ì‹œ ëª¨ë“  ì •ë³´ê°€ ì‚­ì œë©ë‹ˆë‹¤. ì´ëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì£¼ì˜í•´ ì£¼ì„¸ìš”. ğŸš«</p>
		<form id="withdrawal_form">
			<div id="withdrawalReason-title"><h3 class="delete-h3">íƒˆí‡´ ì‚¬ìœ  ì„ íƒ</h3> <div id="withdrawalError" class="error"></div></div>
			 <input type="radio" name="withdrawalReason" id="reason1" value="ì‚¬ì´íŠ¸ ì‚¬ìš©ì˜ ì–´ë ¤ì›€"><label for="reason1">ì‚¬ì´íŠ¸ ì‚¬ìš©ì˜ ì–´ë ¤ì›€</label>
			 <input type="radio" name="withdrawalReason" id="reason2" value="ë‚´ìš©ê³¼ ì„œë¹„ìŠ¤ ë¶ˆë§Œì¡±"><label for="reason2">ë‚´ìš©ê³¼ ì„œë¹„ìŠ¤ ë¶ˆë§Œì¡±</label><br>
			 <input type="radio" name="withdrawalReason" id="reason3" value="ê°œì¸ì •ë³´ ë° ë³´ì•ˆ ìš°ë ¤"><label for="reason3">ê°œì¸ì •ë³´ ë° ë³´ì•ˆ ìš°ë ¤</label>
			 <input type="radio" name="withdrawalReason" id="reason4" value="ì¤‘ë³µ ê°€ì… ë° ê³„ì • ë¬¸ì œ"><label for="reason4">ì¤‘ë³µ ê°€ì… ë° ê³„ì • ë¬¸ì œ</label><br>
			 <input type="radio" name="withdrawalReason" id="reason5" value="ì‚¬ì´íŠ¸ì˜ ë³€ê²½ëœ ë°©í–¥ì„±"><label for="reason5">ì‚¬ì´íŠ¸ì˜ ë³€ê²½ëœ ë°©í–¥ì„±</label>
			 <input type="radio" name="withdrawalReason" id="reason6" value="ë‹¤ë¥¸ ì‚¬ì´íŠ¸ë‚˜ ì•± ì´ìš©"><label for="reason6">ë‹¤ë¥¸ ì‚¬ì´íŠ¸ë‚˜ ì•± ì´ìš©</label><br>
			 <input type="radio" name="withdrawalReason" id="reason7" value="ì´ìš©í•˜ì§€ ì•ŠëŠ” ì„œë¹„ìŠ¤"><label for="reason7">ì´ìš©í•˜ì§€ ì•ŠëŠ” ì„œë¹„ìŠ¤</label>
			 <input type="radio" name="withdrawalReason" id="radioOtherReasons" value="ê¸°íƒ€ ì‚¬ìœ "><label for="radioOtherReasons">ê¸°íƒ€ ì‚¬ìœ </label><br>
			<textarea id="otherReasons" name="otherReasons" rows="4" cols="50" placeholder="ê¸°íƒ€ íƒˆí‡´ ì‚¬ìœ ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”." style="display: none;"></textarea><br>
			<button type="button" id="withdrawal_btn" class="btn_submit">ê³„ì • íƒˆí‡´í•˜ê¸°</button>
		</form>
	</div>
	
<script th:inline="javascript">
	var userData = /*[[${user}]]*/ {};
</script>
<script>
	$(document).ready(function() {
		// console.log(userData); // ì‚¬ìš©ì ì „ì²´ ì •ë³´ í™•ì¸
		// ì‚¬ìš©ì ì •ë³´
		var userNum = userData.user_num;
		var userId = userData.id;
	    
		// ê¸°íƒ€ ì‚¬ìœ  ë¼ë””ì˜¤ ë²„íŠ¼ í´ë¦­ì‹œ textarea í‘œì‹œ
		$("input[name='withdrawalReason']").change(function() {
		    if ($("#radioOtherReasons").is(":checked")) {
		        $("#otherReasons").slideDown();
		    } else {
		        $("#otherReasons").slideUp();
		    }
		});
		
		// íƒˆí‡´í•˜ê¸° ê¸°ëŠ¥
		$("#withdrawal_btn").click(function() {
			// ìœ íš¨ì„± ê²€ì‚¬
			// ë¼ë””ì˜¤ ë²„íŠ¼ ì„ íƒ í™•ì¸
	        if (!$("input[name='withdrawalReason']:checked").val()) {
	            $("#withdrawalError").text("íƒˆí‡´ ì‚¬ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
	            return;
	        }

	        // ê¸°íƒ€ ì‚¬ìœ  ë¼ë””ì˜¤ ë²„íŠ¼ì´ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
	        if ($("#radioOtherReasons").is(":checked")) {
	            // textareaì— ê¸€ìê°€ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸
	            if ($("#otherReasons").val().trim() === "") {
	                $("#withdrawalError").text("ê¸°íƒ€ íƒˆí‡´ ì‚¬ìœ ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.");
	                return;
	            }
	        } else {
	            $("#withdrawalError").text(""); // ê¸°íƒ€ ì‚¬ìœ ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ë¼ë””ì˜¤ ë²„íŠ¼ì´ ì„ íƒë˜ë©´ ì—ëŸ¬ ë©”ì‹œì§€ ì´ˆê¸°í™”
	        }
	        
	    	// í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì„ timestampë¡œ ì…ë ¥í•˜ëŠ” ë¡œì§
	        var date = new Date();
	        date.setHours(date.getHours() + 9); // í•œêµ­ì€ UTCë¡œë¶€í„° +9ì‹œê°„ì´ë¯€ë¡œ 9ë¥¼ ë”í•¨
	        var timestamp = date.toISOString();
	        var deleted_at = timestamp;
		    
	        // íƒˆí‡´ ì‚¬ìœ 
	        var selectedReason = document.querySelector('input[name="withdrawalReason"]:checked').value;
	        if (document.getElementById("radioOtherReasons").checked) {
	            selectedReason = document.getElementById("otherReasons").value;
	        }
	        
	        // ì „ì†¡í•  ë°ì´í„°
		    var formData = {
		    		user_num: userNum,
		    		id: userId,
		    		is_deleted: true,
		    		deleted_user_num: userNum,
		    		deleted_at: deleted_at,
		    		deleted_reason: selectedReason
		    		
		    };
		    // console.log(formData); // formData í™•ì¸
	        
			var isConfirmed = confirm("ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
			if (isConfirmed) {		        
				// íƒˆí‡´ ë¡œì§
				$(this).prop("disabled", true);
				$.ajax({
					url: "/api/delete-user",
					type: "POST",
					contentType: "application/json",
	                data: JSON.stringify(formData),
	                success: function(response) {
	                    alert("ê³„ì • íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
	                    $.ajax({ // ë¡œê·¸ì•„ì›ƒ ìš”ì²­ 
	                        url: "/api/logout",
	                        type: "GET",
	                        success: function() {
	                            window.location.href = "/index.do"
	                        },
	                        error: function(xhr, status, error) {
	                            alert("ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
	                            window.location.href = "/index.do";
	                        }
	                    });
	                },
	                error: function(xhr, status, error) {
	                    alert("ê³„ì • íƒˆí‡´ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
	                },
	                complete: function() {
	                  $("#withdrawal_btn").prop("disabled", false);  // ê³„ì • íƒˆí‡´ ë²„íŠ¼ í™œì„±í™”
	                }
	            });
			}
		});
	});
</script>
