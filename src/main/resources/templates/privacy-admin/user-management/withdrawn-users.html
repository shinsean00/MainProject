<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/adminLayout}">

<head>
    <!-- í˜ì´ì§€ì˜ ì œëª© ì„¤ì • -->
    <title>íƒˆí‡´í•œ íšŒì›</title>

    <!-- í•´ë‹¹ í˜ì´ì§€ ê³ ìœ  CSS ì¶”ê°€ -->
    <th:block layout:fragment="css">
        <link rel="stylesheet" th:href="@{/css/user-management.css}"/>
    </th:block>

    <!-- í•´ë‹¹ í˜ì´ì§€ ê³ ìœ  ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
    <th:block layout:fragment="script">
        <script th:inline="javascript">
            window.users = /*[[${users}]]*/ [];
        </script>
        <script th:src="@{/js/user-management.js}"></script>
        <script>
            $(document).ready(function() {
                // ì‚­ì œ ë²„íŠ¼ 
                $('body').off('click', '.withdrawn_delete_btn').on('click', '.withdrawn_delete_btn', function(event) {
                    event.stopPropagation(); // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ì¤‘ë‹¨
                    const row = $(this).closest('tr');
                    const nickname = row.find('td:nth-child(4)').text();
                    // ì‚­ì œ í™•ì¸ ì•Œë¦¼
                    let confirmationMessage = nickname + "ë‹˜ì˜ ê³„ì •ì„ ì •ë§ ì‚­ì œì‹œí‚¤ì‹œê² ìŠµë‹ˆê¹Œ?";
    
                    if (!window.confirm(confirmationMessage)) {
                        return;
                    }

                    // ajax íšŒì› ì •ë³´ ì‚­ì œ post ìš”ì²­
                    $.ajax({
                        url: "/api/remove-user",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify({ userNum: userNum }),
                        success: function(response) {
                            alert(nickname + "ë‹˜ì˜ ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                            location.reload();
                        },
                        error: function(xhr, status, error) {
                            alert("íšŒì› ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒíƒœ: " + status + ", ì‘ë‹µ: " + xhr.responseText);
                        }
                    });
                });
            });
        </script>
    </th:block>
</head>

<body data-page-type="withdrawnUserManagement">
    <!-- Content -->
    <div layout:fragment="content" class="container">
        <!-- sidebar fragment ì‚¬ìš© -->
        <div th:replace="sidebar/privacy-admin :: userManagementSidebar"></div>
        <div class="content">
            <h2>íƒˆí‡´ íšŒì› ê´€ë¦¬</h2>
            <div>ğŸ”´<span style="font-style: italic; color: #b81426;"> : íƒˆí‡´í•œì§€ 1ë…„ì´ ì§€ë‚˜ ê°œì¸ì •ë³´ ë³´ìœ  ê¸°ê°„ì´ ë§Œë£Œëœ íšŒì›ì…ë‹ˆë‹¤.<span></div>
            <table>
                <div class="table-top-wrapper">
                    <select id="itemsPerPageSelect">
                        <option value="10">10ê°œë¡œ ë³´ê¸°</option>
                        <option value="25">25ê°œë¡œ ë³´ê¸°</option>
                        <option value="50">50ê°œë¡œ ë³´ê¸°</option>
                        <option value="100">100ê°œë¡œ ë³´ê¸°</option>
                    </select>
                    <span>íƒˆí‡´ íšŒì› ì „ì²´ ë¦¬ìŠ¤íŠ¸ : <span th:text="${users.size()}" style="color: #0d6a76;"></span>ëª…</span></span>
                    <div class="table-search-area">
                        ê²€ìƒ‰ : <input>
                    </div>
                </div>
                <thead>
                    <tr>
                        <th>íšŒì› ë²ˆí˜¸ <button type="button" class="sort_btn"></button></th>
                        <th>ì•„ì´ë”” <button type="button" class="sort_btn"></button></th>
                        <th>ì´ë¦„ <button type="button" class="sort_btn"></button></th>
                        <th>ë‹‰ë„¤ì„ <button type="button" class="sort_btn"></button></th>
                        <th>íƒˆí‡´ì¼ <button type="button" class="sort_btn"></button></th>
                        <th>íƒˆí‡´ ì´ìœ <button type="button" class="sort_btn"></button></th>
                        <th>íšŒì› ì‚­ì œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="withdrawnUser : ${withdrawnUsers}">
                        <td th:text="${withdrawnUser.user_num}"></td>
                        <td th:text="${withdrawnUser.id}"></td>
                        <td th:text="${withdrawnUser.name}"></td>
                        <td th:text="${withdrawnUser.nickname}"></td>
                        <td th:text="${#dates.format(withdrawnUser.deleted_at, 'yyyy-MM-dd')}"></td>
                        <td th:text="${withdrawnUser.deleted_reason}"></td>
                    </tr>
                </tbody>
            </table>
            <div class="paging-area">
                <div id="displayRange">
                    <span id="">ì´ <b><span id="usersLength" th:text="${users.size()}"></b></span>ê°œ í•­ëª© ì¤‘ <b><span id="startRange">1</span></b> ~ <b><span id="endRange">10</span></b>ë²ˆ í•­ëª©ê¹Œì§€ í‘œì‹œ ì¤‘ì…ë‹ˆë‹¤.</span>
                </div>
                <div class="pagination">
                    <button id="previousPageButton"></button>
                    <!-- <span>í˜ì´ì§€ : <span id="currentPageDisplay"></span> / <span id="totalPagesDisplay"></span></span> -->
                    <span id="pageNumberContainer"></span>
                    <button id="nextPageButton"></button>
                </div>
            </div>
        </div>
    </div>
    
</body>
</html>
